// FILE: prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Currency {
  GBP
  USD
  EUR
  CAD
  AUD
  JPY
}

enum ItemCondition {
  NEW
  LIKE_NEW
  GOOD
  FAIR
  POOR
}

enum ItemCategory {
  CLOTHING
  SHOES
  TECH
  COLLECTIBLES
  TRADING_CARDS
  WATCHES
  BAGS
  HOME
  BOOKS
  TOYS
  BEAUTY
  OTHER
}

enum ItemStatus {
  UNLISTED
  LISTED
  SOLD
}

enum SellingPlatform {
  NONE
  EBAY
  VINTED
  DEPOP
  STOCKX
  GOAT
  GRAILED
  FACEBOOK
  ETSY
  OTHER
}

model Item {
  id        String   @id @default(cuid())
  userId    String
  name      String

  sku       String?
  quantity  Int      @default(1)

  currency  Currency @default(GBP)

  // cost basis per unit (all-in)
  purchaseSubtotalPence Int @default(0)
  purchaseFeesPence     Int @default(0)
  purchaseShippingPence Int @default(0)

  // listing / selling
  status   ItemStatus      @default(UNLISTED)
  platform SellingPlatform @default(NONE)

  listedPricePence  Int?
  buyerTotalPence   Int?
  soldAt            DateTime?

  // fees (per unit)
  platformFeePence            Int?
  paymentProcessingFeePence   Int?
  postageChargedToBuyerPence  Int?

  // expected range (optional) (per unit)
  expectedBestPence  Int?
  expectedWorstPence Int?

  condition ItemCondition @default(GOOD)
  category  ItemCategory  @default(OTHER)

  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sales     Sale[]

  @@index([userId])
  @@index([userId, status])
  @@index([userId, category])
  @@index([userId, condition])

  @@unique([userId, sku])
}

model Sale {
  id        String   @id @default(cuid())
  userId    String

  itemId    String?
  item      Item?    @relation(fields: [itemId], references: [id], onDelete: SetNull)

  itemName  String
  sku       String?

  platform  SellingPlatform @default(OTHER)
  currency  Currency        @default(GBP)

  soldAt          DateTime
  quantitySold    Int

  salePricePerUnitPence Int
  feesPence             Int @default(0)
  netPence              Int @default(0)

  costPerUnitPence  Int @default(0)
  costTotalPence    Int @default(0)

  notes     String?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([userId, soldAt])
  @@index([userId, itemId])
}
